<?php
/*
* @Program:		NukeViet CMS v2.0 RC1
* @File name: 	Module Base Union Mangager 
* @Version: 	1.0
* @Date: 		09.08.2009
* @Website: 	www.nukeviet.vn
* @Copyright: 	(C) 2009
* @License: 	http://opensource.org/licenses/gpl-license.php GNU Public License
*/

if ( ! defined('NV_SYSTEM') )
{
	die( "You can't access this file directly..." );
}

require_once ( "mainfile.php" );
$module_name = basename( dirname(__file__) );
get_lang( $module_name );
if ( file_exists("" . $datafold . "/config_" . $module_name . ".php") )
{
	@require_once ( "" . $datafold . "/config_" . $module_name . ".php" );
}
if ( defined('_MODTITLE') ) $module_title = _MODTITLE;

$index = ( defined('MOD_BLTYPE') ) ? MOD_BLTYPE : 1;
/********************************************/

/**
 * UserCheck()
 * 
 * @param mixed $username
 * @return
 */
function UserCheck( $username )
{
	global $nick_max, $nick_min;	
	if ( (! $username) || ($username == "") || (ereg("[^a-zA-Z0-9_-]", $username)) )
	{
		$stop = "" . _USERWRONG . "";
	} elseif ( strlen($username) > $nick_max )
	{
		$stop = "" . _USERWRONG . "";
	} elseif ( strlen($username) < $nick_min )
	{
		$stop = "" . _USERWRONG . "";
	} elseif ( strrpos($username, ' ') > 0 )
	{
		$stop = "" . _USERWRONG . "";
	}
	else
	{
		$stop = "";
	}
	return ( $stop );
}


/**
 * login()
 * 
 * @param mixed $username
 * @param mixed $user_password
 * @param mixed $gfx_check
 * @param mixed $remember
 * @param mixed $nvforw
 * @return
 */
function login( $username, $user_password, $remember )
{
	global  $db, $module_name ;
	if ( defined('IS_USER') )
	{
		header( "Location: modules.php?name=Union_Manager" );
		exit();
	}
	$username = check_html( $_POST['username'], nohtml );
	$username = substr( htmlspecialchars(str_replace("\'", "'", trim($username))), 0, $nick_max );
	$username = rtrim( $username, "\\" );
	$username = str_replace( "'", "\'", $username );
	$user_password = htmlspecialchars( $user_password );
	$stop= UserCheck($username);
	if ($stop=="")
	{
		include ( "header.php" );
		OpenTable();
		echo "<br><br><p align=\"center\"><b>" . $stop . "</b><br><br>" . _GOBACK . "</p><br><br>";
		CloseTable();
		include ( "footer.php" );
		return FALSE;
	}
	else
	{
		$sql="SELECT base_id,password FROM sc_base_union where base_id='$username'";
		
		if ($db->sql_numrows($sql)==0)
		{
			return FALSE;
		}
		$result=$db->sql_query($sql);
		$info=$db->sql_fetchrow($result);
		
		
	}
	
}
?>

